#include <curl/curl.h>
#include <filesystem>
#include <fstream>
#include <iostream>

using namespace std;

int main() {
    filesystem::path TARGET_FOLDER("./important_folder");

    // post using to libcurl
    CURL* curl;
    CURLcode res;

    string content;

    for (auto file : filesystem::directory_iterator(TARGET_FOLDER)) {
        string file_path = file.path().string();
        string content;
        ifstream input_stream;
        input_stream.open(file_path);
        while (!input_stream.eof()) {
            char ch = input_stream.get();
            if (ch != EOF) {
                content.push_back(ch);
            }
        }

        input_stream.close();

        // post using to libcurl
        CURL* curl;
        CURLcode res;

        curl = curl_easy_init();
        if (curl) {
            curl_easy_setopt(curl, CURLOPT_URL, "http://localhost:4000");

            curl_easy_setopt(curl, CURLOPT_POSTFIELDS, content.c_str());

            res = curl_easy_perform(curl);

            if (res != CURLE_OK) {
                cout << "Error copying file, please try again" << endl;
            } else {
            }

            curl_easy_cleanup(curl);
        }
    }
    return 0;
}
