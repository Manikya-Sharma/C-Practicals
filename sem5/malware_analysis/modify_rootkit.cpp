#include <curl/curl.h>
#include <filesystem>
#include <fstream>
#include <iostream>

using namespace std;

int main() {
    filesystem::path TARGET_FOLDER("./important_folder");

    // post using to libcurl
    CURL* curl;
    CURLcode res;

    string modify_data;
    cout << "Enter data to modify:";
    cin >> modify_data;

    for (auto file : filesystem::directory_iterator(TARGET_FOLDER)) {
        string file_path = file.path().string();
        string content;
        ifstream input_stream;
        input_stream.open(file_path);
        while (!input_stream.eof()) {
            char ch = input_stream.get();
            if (ch != EOF) {
                content.push_back(ch);
            }
        }
        input_stream.close();

        ofstream output_stream;
        output_stream.open(file_path);
        for (auto ch : modify_data) {
            output_stream << ch;
        }
        output_stream << EOF;
        output_stream.close();

        // post using to libcurl
        CURL* curl;
        CURLcode res;

        curl = curl_easy_init();
        curl_easy_setopt(curl, CURLOPT_URL, "http://localhost:4000");

        curl_easy_setopt(curl, CURLOPT_POSTFIELDS,
                         ("OLD DATA: " + content).c_str());
        res = curl_easy_perform(curl);

        curl_easy_cleanup(curl);

        curl = curl_easy_init();
        curl_easy_setopt(curl, CURLOPT_URL, "http://localhost:4000");
        curl_easy_setopt(curl, CURLOPT_POSTFIELDS,
                         ("NEW DATA: " + modify_data).c_str());
        res = curl_easy_perform(curl);

        curl_easy_cleanup(curl);
    }
    return 0;
}
